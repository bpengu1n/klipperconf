
########################################
# BL-Touch configuration
########################################

# [bltouch]
# sensor_pin: ^PROBE_SENSOR
# # #   Pin connected to the BLTouch sensor pin. Most BLTouch devices
# # #   require a pullup on the sensor pin (prefix the pin name with "^").
# # #   This parameter must be provided.
# control_pin: PROBE_SERVO
# # #   Pin connected to the BLTouch control pin. This parameter must be
# # #   provided.
# # #pin_move_time: 0.680
# # #   The amount of time (in seconds) to wait for the BLTouch pin to
# # #   move up or down. The default is 0.680 seconds.
# stow_on_each_sample: False
# # #   This determines if Klipper should command the pin to move up
# # #   between each probe attempt when performing a multiple probe
# # #   sequence. Read the directions in docs/BLTouch.md before setting
# # #   this to False. The default is True.
# #probe_with_touch_mode: True
# #   If this is set to True then Klipper will probe with the device in
# #   "touch_mode". The default is False (probing in "pin_down" mode).
# pin_up_reports_not_triggered: True
# #   Set if the BLTouch consistently reports the probe in a "not
# #   triggered" state after a successful "pin_up" command. This should
# #   be True for all genuine BLTouch devices. Read the directions in
# #   docs/BLTouch.md before setting this to False. The default is True.
# #pin_up_touch_mode_reports_triggered: True
# #   Set if the BLTouch consistently reports a "triggered" state after
# #   the commands "pin_up" followed by "touch_mode". This should be
# #   True for all genuine BLTouch devices. Read the directions in
# #   docs/BLTouch.md before setting this to False. The default is True.
# #set_output_mode:
# #   Request a specific sensor pin output mode on the BLTouch V3.0 (and
# #   later). This setting should not be used on other types of probes.
# #   Set to "5V" to request a sensor pin output of 5 Volts (only use if
# #   the controller board needs 5V mode and is 5V tolerant on its input
# #   signal line). Set to "OD" to request the sensor pin output use
# #   open drain mode. The default is to not request an output mode.
# x_offset: -47
# y_offset: -13
# speed: 50
# lift_speed: 50
# samples: 3
# #   The number of times to probe each point. The probed z-values will
# #   be averaged. The default is to probe 1 time.
# #sample_retract_dist: 2mm
# samples_result: average
# #   The calculation method when sampling more than once - either
# #   "median" or "average". The default is average.
# samples_tolerance: 0.040
# #   The maximum Z distance (in mm) that a sample may differ from other
# #   samples. If this tolerance is exceeded then either an error is
# #   reported or the attempt is restarted (see
# #   samples_tolerance_retries). The default is 0.100mm.
# samples_tolerance_retries: 5
#   The number of times to retry if a sample is found that exceeds
#   samples_tolerance. On a retry, all current samples are discarded
#   and the probe attempt is restarted. If a valid set of samples are
#   not obtained in the given number of retries then an error is
#   reported. The default is zero which causes an error to be reported
#   on the first sample that exceeds samples_tolerance.
#   See the "probe" section for information on these parameters.


[dockable_probe]
pin: ^Z_STOP #Change to where you plug your probe in, endstop or probe pin pulled high (^)
#z_offset: 0 #Measure per your specific setup. Klipper will NOT save this value if this in not located in printer.cfg
x_offset: 8.30 # negative = left of the nozzle
y_offset: 19 # negative = in front of of the nozzle
speed: 3.0
lift_speed: 15.0
sample_retract_dist: 2
samples: 5
samples_result: median
samples_tolerance: 0.025
samples_tolerance_retries: 10
approach_position:
# The most common dock designs use a fork or arms that extend out from the dock. In order to attach the probe to the toolhead, the toolhead must move into and away from the dock to a particular position so these arms can capture the probe body.
# As with dock_position, a Z position is not required but if specified the toolhead will be moved to that Z location before the X, Y coordinates.
# For magnetically coupled probes, the approach_position should be far enough away from the probe dock such that the magnets on the probe body are not attracted to the magnets on the toolhead.
dock_position:
# This is the XYZ coordinates where the toolhead needs to be positioned in order to attach the probe. This parameter is X, Y and, Z separated by commas.
# Many configurations have the dock attached to a moving gantry. This means that Z axis positioning is irrelevant. However, it may be necessary to move the gantry clear of the bed or other printer components before performing docking steps. In this case, specify z_hop to force a Z movement.
# Other configurations may have the dock mounted next to the printer bed so that the Z position must be known prior to attaching the probe. In this configuration the Z axis parameter must be supplied, and the Z axis must be homed prior to attaching the probe.
detach_position:
# Most probes with magnets require the toolhead to move in a direction that strips the magnets off with a sliding motion. This is to prevent the magnets from becoming unseated from repeated pulling and thus affecting probe accuracy. The detach_position is typically defined as a point that is perpendicular to the dock so that when the toolhead moves, the probe stays docked but cleanly detaches from the toolhead mount.
# As with dock_position, a Z position is not required but if specified the toolhead will be moved to that Z location before the X, Y coordinates.
# For magnetically coupled probes, the detach_position should be far enough away from the probe dock such that the magnets on the probe body are not attracted to the magnets on the toolhead.
z-hop: 20
# Distance (in mm) to lift the Z axis prior to attaching/detaching the probe. If the Z axis is already homed and the current Z position is less than z_hop, then this will lift the head to a height of z_hop. If the Z axis is not already homed the head is lifted by z_hop. The default is to not implement Z hop.

########################################
# Bed Leveling configuration
########################################


[bed_mesh]
speed: 120
horizontal_move_z: 5
mesh_min: 8.3,19     # Probe coordinates
mesh_max: 224.3, 219
fade_end: 10
fade_target: 0
probe_count: 9,9
algorithm: bicubic
adaptive_margin: 10
[homing_override]
set_position_z:0 # Make printer think Z axis is at zero, so we can force a move upwards away from build plate
axes: z #will only call override if x is involved in the homing call
gcode:
  G90
  G1 Z10 F3000 ; move up to prevent accidentally scratching build plate    
  {% if "x" not in (printer.toolhead.homed_axes | lower) %}
      G28 X
  {% endif %}
  {% if "y" not in (printer.toolhead.homed_axes | lower) %}
      G28 Y        #Will only home XY if they are not currently homed
  {% endif %}
  Attach_Probe
  G1 X113.5 Y96.5 F6000 ; Adjusted for normal klack offsets with a 235x235 bed X: 117.5 - x_offset, Y: 117.5 - y_offset
  G28 Z
  Dock_Probe

# [safe_z_home]
# home_xy_position: 148.5,117.5
# speed: 100
# z_hop: 10
# z_hop_speed: 5

# # manual Bed adjustment via BED_SCREWS_ADJUST
# [bed_screws]
# screw1: 72.5, 41.5
# screw1_name: front left screw
# screw2: 198.5,35.5
# screw2_name: front right screw
# screw3: 198.5,205.5
# screw3_name: rear right screw
# screw4: 28.5,205.5
# screw4_name: rear left screw
# horizontal_move_z: 10
# speed: 50

[screws_tilt_adjust]
screw1: 20.5,172.5
screw1_name: rear left screw
screw2: 20.5, 21.5
screw2_name: front left screw
screw3: 202.5,21.5
screw3_name: front right screw
screw4: 202.5,172.5
screw4_name: rear right screw

horizontal_move_z: 10
speed: 50
screw_thread: CW-M4

# [gcode_macro G29]
# gcode:
#     G28
#     Attach_Probe
#     BED_MESH_CALIBRATE
#     G0 X0 Y0 Z10 F6000
#     BED_MESH_PROFILE save=default
#     Dock_Probe
#     SAVE_CONFIG

[z_tilt]
z_positions: -37.5, 71.5
                     250.0, 71.5
#   A list of X, Y coordinates (one per line; subsequent lines
#   indented) describing the location of each bed "pivot point". The
#   "pivot point" is the point where the bed attaches to the given Z
#   stepper. It is described using nozzle coordinates (the X, Y position
#   of the nozzle if it could move directly above the point). The
#   first entry corresponds to stepper_z, the second to stepper_z1,
#   the third to stepper_z2, etc. This parameter must be provided.
points: 33.50, 117.50
        208.50, 117.50
#   A list of X, Y coordinates (one per line; subsequent lines
#   indented) that should be probed during a Z_TILT_ADJUST command.
#   Specify coordinates of the nozzle and be sure the probe is above
#   the bed at the given nozzle coordinates. This parameter must be
#   provided.
#speed: 50
#   The speed (in mm/s) of non-probing moves during the calibration.
#   The default is 50.
#horizontal_move_z: 5
#   The height (in mm) that the head should be commanded to move to
#   just prior to starting a probe operation. The default is 5.
#retries: 0
#   Number of times to retry if the probed points aren't within
#   tolerance.
#retry_tolerance: 0
#   If retries are enabled then retry if largest and smallest probed
#   points differ more than retry_tolerance. Note the smallest unit of
#   change here would be a single step. However if you are probing
#   more points than steppers then you will likely have a fixed
#   minimum value for the range of probed points which you can learn
#   by observing command output.